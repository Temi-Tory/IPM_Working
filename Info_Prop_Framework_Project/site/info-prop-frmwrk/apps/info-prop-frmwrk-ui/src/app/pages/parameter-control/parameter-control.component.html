 <mat-card class="parameter-control-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>tune</mat-icon>
      Parameter Controls
    </mat-card-title>
    <mat-card-subtitle>
      Configure global and individual node/edge parameters
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- Parameter Status Summary -->
    <div class="parameter-status" *ngIf="networkData">
      <div class="status-chips">
        <mat-chip-set>
            <mat-chip 
                [color]="hasGlobalOverrides() ? 'primary' : ''"
                role="listitem">
                <mat-icon>public</mat-icon>
                Global Overrides
            </mat-chip>
            <mat-chip 
                [color]="hasIndividualOverrides() ? 'accent' : ''"
                role="listitem">
                <mat-icon>person</mat-icon>
                Individual Overrides: {{ getModifiedParametersCount() }}
            </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <!-- Validation Messages -->
    <div class="validation-messages" *ngIf="!parameterValidation.isValid || parameterValidation.warnings.length > 0">
      <div class="error-messages" *ngIf="!parameterValidation.isValid">
        <mat-icon class="error-icon">error</mat-icon>
        <ul>
          <li *ngFor="let error of parameterValidation.errors">{{ error }}</li>
        </ul>
      </div>
      <div class="warning-messages" *ngIf="parameterValidation.warnings.length > 0">
        <mat-icon class="warning-icon">warning</mat-icon>
        <ul>
          <li *ngFor="let warning of parameterValidation.warnings">{{ warning }}</li>
        </ul>
      </div>
    </div>

    <!-- Parameter Control Tabs -->
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="parameter-tabs">
      
      <!-- Global Parameters Tab -->
      <mat-tab label="Global Parameters">
        <div class="tab-content">
          <form [formGroup]="globalParametersForm" class="global-parameters-form">
            
            <!-- Global Node Prior Control -->
            <mat-expansion-panel class="parameter-panel">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>account_tree</mat-icon>
                  Global Node Prior
                </mat-panel-title>
                <mat-panel-description>
                  Apply single prior value to all nodes
                </mat-panel-description>
              </mat-expansion-panel-header>
              
              <div class="panel-content">
                <div class="toggle-control">
                  <mat-slide-toggle formControlName="useGlobalNodePrior">
                    Override all node priors
                  </mat-slide-toggle>
                </div>
                
                <div class="slider-control" *ngIf="globalParametersForm.get('useGlobalNodePrior')?.value">
                  <mat-form-field appearance="outline" class="value-input">
                    <mat-label>Node Prior Value</mat-label>
                    <input 
                      matInput 
                      type="number" 
                      min="0" 
                      max="1" 
                      step="0.001"
                      formControlName="globalNodePrior">
                  </mat-form-field>
                  
                  <mat-slider 
                    min="0" 
                    max="1" 
                    step="0.01" 
                    discrete 
                    showTickMarks
                    class="parameter-slider">
                    <input matSliderThumb formControlName="globalNodePrior">
                  </mat-slider>
                  
                  <div class="slider-description">
                    <small>0 = Never active, 1 = Always active</small>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- Global Edge Probability Control -->
            <mat-expansion-panel class="parameter-panel">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>timeline</mat-icon>
                  Global Edge Probability
                </mat-panel-title>
                <mat-panel-description>
                  Apply single probability value to all edges
                </mat-panel-description>
              </mat-expansion-panel-header>
              
              <div class="panel-content">
                <div class="toggle-control">
                  <mat-slide-toggle formControlName="useGlobalEdgeProb">
                    Override all edge probabilities
                  </mat-slide-toggle>
                </div>
                
                <div class="slider-control" *ngIf="globalParametersForm.get('useGlobalEdgeProb')?.value">
                  <mat-form-field appearance="outline" class="value-input">
                    <mat-label>Edge Probability Value</mat-label>
                    <input 
                      matInput 
                      type="number" 
                      min="0" 
                      max="1" 
                      step="0.001"
                      formControlName="globalEdgeProb">
                  </mat-form-field>
                  
                  <mat-slider 
                    min="0" 
                    max="1" 
                    step="0.01" 
                    discrete 
                    showTickMarks
                    class="parameter-slider">
                    <input matSliderThumb formControlName="globalEdgeProb">
                  </mat-slider>
                  
                  <div class="slider-description">
                    <small>0 = Never propagates, 1 = Always propagates</small>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- Individual Overrides Toggle -->
            <mat-expansion-panel class="parameter-panel">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>person</mat-icon>
                  Individual Overrides
                </mat-panel-title>
                <mat-panel-description>
                  Enable specific node/edge parameter customization
                </mat-panel-description>
              </mat-expansion-panel-header>
              
              <div class="panel-content">
                <div class="toggle-control">
                  <mat-slide-toggle formControlName="useIndividualOverrides">
                    Enable individual parameter controls
                  </mat-slide-toggle>
                </div>
                
                <div class="individual-info" *ngIf="globalParametersForm.get('useIndividualOverrides')?.value">
                  <p>
                    <mat-icon>info</mat-icon>
                    Use the "Node Parameters" and "Edge Parameters" tabs to modify individual values.
                  </p>
                </div>
              </div>
            </mat-expansion-panel>

          </form>

          <!-- Global Actions -->
          <div class="global-actions">
            <button mat-raised-button color="warn" (click)="resetAllParameters()">
              <mat-icon>restore</mat-icon>
              Reset All Parameters
            </button>
            
            <button mat-raised-button (click)="exportParameters()">
              <mat-icon>download</mat-icon>
              Export Parameters
            </button>
            
            <button mat-raised-button>
              <mat-icon>upload</mat-icon>
              Import Parameters
              <input 
                type="file" 
                accept=".json" 
                (change)="importParameters($event)"
                style="display: none;">
            </button>
          </div>
        </div>
      </mat-tab>

      <!-- Node Parameters Tab -->
      <mat-tab label="Node Parameters" [disabled]="!networkData">
        <div class="tab-content">
          
          <!-- Node Parameter Controls -->
          <div class="parameter-table-controls">
            <div class="table-header">
              <h3>
                <mat-icon>account_tree</mat-icon>
                Node Prior Values
              </h3>
              <div class="controls-right">
                <button 
                  mat-icon-button 
                  (click)="showNodeSearch = !showNodeSearch"
                  matTooltip="Search nodes">
                  <mat-icon>search</mat-icon>
                </button>
              </div>
            </div>
            
            <!-- Node Search -->
            <mat-form-field 
              *ngIf="showNodeSearch" 
              appearance="outline" 
              class="search-field">
              <mat-label>Search nodes...</mat-label>
              <input matInput [(ngModel)]="nodeSearchTerm" placeholder="Enter node ID">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <!-- Bulk Node Operations -->
            <div class="bulk-operations" *ngIf="allowBulkEdit">
              <div class="bulk-input">
                <mat-form-field appearance="outline">
                  <mat-label>Set all node priors to:</mat-label>
                  <input 
                    matInput 
                    type="number" 
                    min="0" 
                    max="1" 
                    step="0.01"
                    #bulkNodeValue>
                </mat-form-field>
                <button 
                  mat-raised-button 
                  color="primary"
                  (click)="setAllNodePriors(+bulkNodeValue.value)">
                  Apply to All
                </button>
              </div>
              <button 
                mat-stroked-button 
                (click)="resetAllNodeParameters()"
                matTooltip="Reset all node parameters to original values">
                <mat-icon>restore</mat-icon>
                Reset All Nodes
              </button>
            </div>
          </div>

          <!-- Node Parameters Table -->
          <div class="parameter-table">
            <table mat-table [dataSource]="getFilteredNodeParameters()" class="parameters-table">
              
              <!-- Node ID Column -->
              <ng-container matColumnDef="nodeId">
                <th mat-header-cell *matHeaderCellDef>Node ID</th>
                <td mat-cell *matCellDef="let param">
                  <span class="node-id">{{ param.nodeId }}</span>
                </td>
              </ng-container>

              <!-- Original Value Column -->
              <ng-container matColumnDef="originalValue">
                <th mat-header-cell *matHeaderCellDef>Original</th>
                <td mat-cell *matCellDef="let param">
                  <span class="original-value">{{ param.originalValue | number:'1.3-3' }}</span>
                </td>
              </ng-container>

              <!-- Current Value Column -->
              <ng-container matColumnDef="currentValue">
                <th mat-header-cell *matHeaderCellDef>Current Value</th>
                <td mat-cell *matCellDef="let param">
                  <mat-form-field appearance="outline" class="table-input">
                    <input 
                      matInput 
                      type="number" 
                      min="0" 
                      max="1" 
                      step="0.001"
                      [value]="param.currentValue"
                      (input)="onNodeParameterChange(param, +$any($event.target).value)"
                      [class.modified]="param.isModified">
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let param">
                  <button 
                    mat-icon-button 
                    *ngIf="param.isModified"
                    (click)="resetNodeParameter(param)"
                    matTooltip="Reset to original value"
                    color="warn">
                    <mat-icon>restore</mat-icon>
                  </button>
                  <mat-icon 
                    *ngIf="param.isModified" 
                    class="modified-indicator"
                    matTooltip="Modified from original">
                    edit
                  </mat-icon>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="nodeDisplayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: nodeDisplayedColumns;"></tr>
            </table>
          </div>
        </div>
      </mat-tab>

      <!-- Edge Parameters Tab -->
      <mat-tab label="Edge Parameters" [disabled]="!networkData">
        <div class="tab-content">
          
          <!-- Edge Parameter Controls -->
          <div class="parameter-table-controls">
            <div class="table-header">
              <h3>
                <mat-icon>timeline</mat-icon>
                Edge Probability Values
              </h3>
              <div class="controls-right">
                <button 
                  mat-icon-button 
                  (click)="showEdgeSearch = !showEdgeSearch"
                  matTooltip="Search edges">
                  <mat-icon>search</mat-icon>
                </button>
              </div>
            </div>
            
            <!-- Edge Search -->
            <mat-form-field 
              *ngIf="showEdgeSearch" 
              appearance="outline" 
              class="search-field">
              <mat-label>Search edges...</mat-label>
              <input matInput [(ngModel)]="edgeSearchTerm" placeholder="Enter node IDs">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <!-- Bulk Edge Operations -->
            <div class="bulk-operations" *ngIf="allowBulkEdit">
              <div class="bulk-input">
                <mat-form-field appearance="outline">
                  <mat-label>Set all edge probabilities to:</mat-label>
                  <input 
                    matInput 
                    type="number" 
                    min="0" 
                    max="1" 
                    step="0.01"
                    #bulkEdgeValue>
                </mat-form-field>
                <button 
                  mat-raised-button 
                  color="primary"
                  (click)="setAllEdgeProbabilities(+bulkEdgeValue.value)">
                  Apply to All
                </button>
              </div>
              <button 
                mat-stroked-button 
                (click)="resetAllEdgeParameters()"
                matTooltip="Reset all edge parameters to original values">
                <mat-icon>restore</mat-icon>
                Reset All Edges
              </button>
            </div>
          </div>

          <!-- Edge Parameters Table -->
          <div class="parameter-table">
            <table mat-table [dataSource]="getFilteredEdgeParameters()" class="parameters-table">
              
              <!-- Edge Column -->
              <ng-container matColumnDef="edge">
                <th mat-header-cell *matHeaderCellDef>Edge</th>
                <td mat-cell *matCellDef="let param">
                  <span class="edge-label">
                    {{ param.fromNode }} â†’ {{ param.toNode }}
                  </span>
                </td>
              </ng-container>

              <!-- Original Value Column -->
              <ng-container matColumnDef="originalValue">
                <th mat-header-cell *matHeaderCellDef>Original</th>
                <td mat-cell *matCellDef="let param">
                  <span class="original-value">{{ param.originalValue | number:'1.3-3' }}</span>
                </td>
              </ng-container>

              <!-- Current Value Column -->
              <ng-container matColumnDef="currentValue">
                <th mat-header-cell *matHeaderCellDef>Current Value</th>
                <td mat-cell *matCellDef="let param">
                  <mat-form-field appearance="outline" class="table-input">
                    <input 
                      matInput 
                      type="number" 
                      min="0" 
                      max="1" 
                      step="0.001"
                      [value]="param.currentValue"
                      (input)="onEdgeParameterChange(param, +$any($event.target).value)"
                      [class.modified]="param.isModified">
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let param">
                  <button 
                    mat-icon-button 
                    *ngIf="param.isModified"
                    (click)="resetEdgeParameter(param)"
                    matTooltip="Reset to original value"
                    color="warn">
                    <mat-icon>restore</mat-icon>
                  </button>
                  <mat-icon 
                    *ngIf="param.isModified" 
                    class="modified-indicator"
                    matTooltip="Modified from original">
                    edit
                  </mat-icon>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="edgeDisplayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: edgeDisplayedColumns;"></tr>
            </table>
          </div>
        </div>
      </mat-tab>

    </mat-tab-group>
  </mat-card-content>
</mat-card>